SELECT FN.PERIODO() AS PERIODO;

update COMERCIAL.VENTAS_REPORTE_MENSUAL
SET CODIGO_CLIENTE=C.CODIGO
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL AS V INNER JOIN  MAESTRO.CLIENTES AS C 
ON  V.CODI_EMPRESA=C.CODI_EMPRESA
AND V.CODI_CLIENTE=C.CODI_CLIENTE
AND V.CLIE_DIRE=C.DIRE_ENTREGA
where V.PERIODO=${PERIODO}
AND C.CODI_EMPRESA IN ('DN','GA');


update COMERCIAL.VENTAS_REPORTE_MENSUAL
SET  CODI_ARTEMP=C.CODIGO
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL AS V  inner join 
MAESTRO.JERARQUIA_PRODUCTO AS C 
on   V.CODI_EMPRESA=C.CODI_EMPRESA
AND V.CODI_ARTICULO=C.CODI_ARTICULO
where V.PERIODO=${PERIODO}
AND C.CODI_EMPRESA  IN ('DN','GA');


update COMERCIAL.VENTAS_REPORTE_MENSUAL
SET  ID_FECHA=C.CODIGO
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL AS V   inner join 
MAESTRO.DIM_TIEMPOS AS C 
ON FORMAT_DATE("%Y/%m/%d", DATE(V.FECHA_FACTURA)) = FORMAT_DATE("%Y/%m/%d", DATE(C.FECHA))
AND V.PERIODO=C.PERIODO
where V.PERIODO=${PERIODO}
AND V.CODI_EMPRESA IN ('DN','GA');



UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET CODI_CAUSA=  '99'
where (CODI_CAUSA is null or CODI_CAUSA='' or CODI_CAUSA=' ')
AND PERIODO=${PERIODO}
AND CODI_EMPRESA IN ('DN','GA');



UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET CODIGO_CAUSAL=  C.CODIGO
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL AS V  inner join MAESTRO.DIM_CAUSALES AS C
on  V.CODI_EMPRESA=C.CODI_EMPRESA
AND LTRIM(rtrim(V.CODI_CAUSA))=LTRIM(RTRIM(C.CODI_DEFINICION))
where  V.PERIODO=${PERIODO}
AND V.CODI_EMPRESA IN ('DN','GA');



UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET CODI_SUBCAUSA='99'
WHERE (CODI_SUBCAUSA='' OR CODI_SUBCAUSA IS NULL   or  CODI_SUBCAUSA=' ')
AND PERIODO=${PERIODO}
AND CODI_EMPRESA IN ('DN','GA');



UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET CODIGO_SUBCAUSAL=  C.CODIGO  
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL AS V inner join MAESTRO.DIM_SUBCAUSALES AS C
on V.CODI_EMPRESA=C.CODI_EMPRESA
AND LTRIM(rtrim(V.CODI_SUBCAUSA))=LTRIM(RTRIM(C.CODI_DEFINICION))
where  V.PERIODO=${PERIODO}
AND V.CODI_EMPRESA IN ('DN','GA');



UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET  VALOR_DESC=0,
VALOR_DEVO=0,
VALOR_OTRAMONE=0,
VALOR_UNITARIO=0	
WHERE INDICA_KIT=3
AND PERIODO=${PERIODO}
AND CODI_EMPRESA IN ( 'DN','GA');


UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET INDICA_KIT=2
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL AS V inner join MAESTRO.JERARQUIA_PRODUCTO AS P
on V.CODI_ARTICULO=P.CODI_ARTICULO AND V.CODI_EMPRESA=P.CODI_EMPRESA  
where V.PERIODO=${PERIODO}
AND TIPO_ARTICULO IN ('K','Z')
AND V.CODI_EMPRESA IN ( 'DN','GA','CD');



/*UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET PK_LINEA=L.DESC_LINEA
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL AS V inner join MAESTRO.JERARQUIA_PRODUCTO AS P
on  V.CODI_ARTEMP=P.CODIGO
inner join (SELECT * FROM MAESTRO.DEFINICIONES WHERE CODI_TABLA="PCLS") AS L
on  P.CODI_EMPRESA=L.CODI_EMPRESA
AND P.CODI_LINEA=L.CODI_DEFINICION 
WHERE V.PERIODO=1
AND V.CODI_EMPRESA in ('DN','GA');*/

/*
UPDATE COMERCIAL.VENTAS_REPORTE_MENSUAL
SET LITRO_BRUTO=0,
LITRO_NC=0,
LITRO_NETO=0,
VALOR_BRUTO=0,
LITRO_BRUTOK=0,
LITRO_NCK=0,
LITRO_NETOK=0,
VALOR_NC=0,
VALOR_NETO=0,
VALOR_NETOK=0,
VALOR_NCK=0
WHERE INDICA_KIT=2
AND PERIODO=1
AND CODI_EMPRESA IN ('DN','GA');*/


Update MAESTRO.DIASH_REGIONAL
set ID_FECHA=D.CODIGO
FROM MAESTRO.DIASH_REGIONAL AS R 
INNER JOIN  MAESTRO.DIM_TIEMPOS AS D ON D.PERIODO=R.PERIODO
AND FORMAT_DATE("%Y/%m/%d", DATE(D.FECHA)) =  FORMAT_DATE("%Y/%m/%d", DATE(R.FECHA))
WHERE R.PERIODO=${PERIODO}
AND FORMAT_DATE("%Y/%m/%d", DATE(D.FECHA)) <=  FORMAT_DATE("%Y/%m/%d", DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY));