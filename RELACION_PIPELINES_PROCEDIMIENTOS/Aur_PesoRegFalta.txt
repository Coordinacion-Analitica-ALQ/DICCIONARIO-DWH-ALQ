SELECT FN.PERIODO() AS PERIODO;

INSERT INTO MAESTRO.DIASH_REGIONAL
SELECT DISTINCT 'RAN','REGIONAL ANTIOQUIA', PERIODO, FECHA_FACTURA, 0, ID_FECHA 
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL
WHERE PERIODO = ${PERIODO} 
AND TRIM(CODI_EMPRESA) IN ('GA','DN')
AND ID_FECHA NOT IN 
(SELECT DISTINCT ID_FECHA FROM MAESTRO.DIASH_REGIONAL
WHERE PERIODO = ${PERIODO} 
AND ID_FECHA IS NOT NULL
AND TRIM(CODI_REGIONAL)='RAN') 
AND DATE(FECHA_FACTURA) = DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY)

UNION ALL

SELECT DISTINCT 'RES','REGIONAL ESTE', PERIODO, FECHA_FACTURA, 0, ID_FECHA 
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL
WHERE PERIODO = ${PERIODO}  
AND TRIM(CODI_EMPRESA) IN ('GA','DN')
AND ID_FECHA NOT IN 
(SELECT DISTINCT ID_FECHA FROM MAESTRO.DIASH_REGIONAL
WHERE PERIODO = ${PERIODO} 
AND ID_FECHA IS NOT NULL
AND TRIM(CODI_REGIONAL)='RES') 
AND DATE(FECHA_FACTURA) = DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY)

UNION ALL

SELECT DISTINCT 'REJ','REGIONAL EJE', PERIODO, FECHA_FACTURA, 0, ID_FECHA 
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL
WHERE PERIODO = ${PERIODO} 
AND TRIM(CODI_EMPRESA) IN ('GA','DN')
AND ID_FECHA NOT IN 
(SELECT DISTINCT ID_FECHA 
FROM MAESTRO.DIASH_REGIONAL
WHERE PERIODO = ${PERIODO}
AND ID_FECHA IS NOT NULL
AND TRIM(CODI_REGIONAL) = 'REJ') 
AND DATE(FECHA_FACTURA) = DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY)

UNION ALL

SELECT DISTINCT 'RCO','REGIONAL COSTA', PERIODO, FECHA_FACTURA, 0, ID_FECHA 
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL
WHERE PERIODO = ${PERIODO} 
AND TRIM(CODI_EMPRESA) IN ('GA','DN') 
AND ID_FECHA NOT IN 
(SELECT DISTINCT ID_FECHA 
FROM MAESTRO.DIASH_REGIONAL
WHERE PERIODO = ${PERIODO}
AND ID_FECHA IS NOT NULL
AND TRIM(CODI_REGIONAL) = 'RCO') 
AND DATE(FECHA_FACTURA) = DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY)

UNION ALL

SELECT DISTINCT 'ROC','REGIONAL OCCIDENTE',PERIODO, FECHA_FACTURA, 0, ID_FECHA 
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL
WHERE PERIODO = ${PERIODO}
AND TRIM(CODI_EMPRESA) IN ('GA','DN') 
AND ID_FECHA NOT IN 
(SELECT DISTINCT ID_FECHA 
FROM MAESTRO.DIASH_REGIONAL
WHERE PERIODO = ${PERIODO}
AND ID_FECHA IS NOT NULL
AND TRIM(CODI_REGIONAL) = 'ROC') 
AND DATE(FECHA_FACTURA) = DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY)

UNION ALL

SELECT DISTINCT 'RBO','REGIONAL BOGOTA', PERIODO, FECHA_FACTURA, 0, ID_FECHA 
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL
WHERE PERIODO = ${PERIODO}
AND TRIM(CODI_EMPRESA) IN ('GA','DN')
AND ID_FECHA NOT IN 
(SELECT DISTINCT ID_FECHA 
FROM MAESTRO.DIASH_REGIONAL
WHERE PERIODO = ${PERIODO}
AND ID_FECHA IS NOT NULL
AND TRIM(CODI_REGIONAL) = 'RBO') 
AND DATE(FECHA_FACTURA) = DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY)

UNION ALL

SELECT DISTINCT 'RPF','REGIONAL PERIFERIA', PERIODO, FECHA_FACTURA, 0, ID_FECHA 
FROM COMERCIAL.VENTAS_REPORTE_MENSUAL
WHERE PERIODO = ${PERIODO}
AND TRIM(CODI_EMPRESA) IN ('GA','DN') 
AND ID_FECHA NOT IN 
(SELECT DISTINCT ID_FECHA 
FROM MAESTRO.DIASH_REGIONAL
WHERE PERIODO = ${PERIODO}
AND ID_FECHA IS NOT NULL
AND TRIM(CODI_REGIONAL) = 'RPF') 
AND DATE(FECHA_FACTURA) = DATE_SUB(CURRENT_DATE("America/Bogota"), INTERVAL 1 DAY)
ORDER BY FECHA_FACTURA;