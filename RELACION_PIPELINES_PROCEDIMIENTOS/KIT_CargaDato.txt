INSERT INTO MAESTRO.TABLA_KITS ( CODI_EMPRESA, CODI_KIT,CODI_ARTICULO,
CANTIDAD,FECHA_CREACION,PERIODO )
-- registros para insertar
SELECT DISTINCT  P.CODI_EMPRESA, P.CODI_KIT, P.CODI_ARTICULO,P.CANTIDAD,
        P.FECHA_CREACION,CAST(P.PERIODO AS INT64)
FROM ( 
    -- limpieza de espacios
    SELECT  CODI_EMPRESA,CODIGO_KIT AS CODI_KIT,HIJO_KIT AS CODI_ARTICULO,  
     CAST(CANTIDAD_KIT AS INT64)  AS CANTIDAD, CAST(PARSE_DATE(%Y%m%d, CAST(FECHA AS STRING)) AS TIMESTAMP) AS FECHA_CREACION,
       CONCAT(1,SUBSTRING(CAST(FECHA AS STRING) ,3,4)) AS  PERIODO          
    FROM MAESTRO.DATO_KIT
    ) AS P
  LEFT JOIN   MAESTRO.TABLA_KITS C
    ON (P.CODI_EMPRESA)=(C.CODI_EMPRESA) 
      AND (P.CODI_KIT)=(C.CODI_KIT);

 UPDATE MAESTRO.TABLA_KITS  T
  SET CODI_ARTEMP=P.CODIGO
 FROM MAESTRO.JERARQUIA_PRODUCTO P
  WHERE T.CODI_EMPRESA=P.CODI_EMPRESA
  AND T.CODI_KIT=P.CODI_ARTICULO;
