SELECT FN.PERIODO() AS PERIODO;

truncate table COMERCIAL.LISTA_PRECIO;

INSERT INTO  COMERCIAL.LISTA_PRECIO
(CODI_EMPRESA, CODI_LISTA, DESC_LISTA, CODI_GRUPOCLIE, FECHA_INICIAL, FECHA_FINAL, 
CODI_ARTICULO, VALOR, PERIODO, CODI_CLIENTE, SECUENCIA)
select  CONO16 CODI_EMPRESA,PRTP15 CODI_LISTA, DESC15 DESC_LISTA, 
CUSG16 CODI_GRUPOCLIE ,SDAT16 , (ENDT16) FECHA_FINAL, 
PNUM16 CODI_ARTICULO,  VRT116 VALOR ,${PERIODO}   ,CUSN19,DSEQ19
from PRUBSYSTEM.S10EB95C.AULT2F3ALQ.OEP16 INNER JOIN 
PRUBSYSTEM.S10EB95C.AULT2F3ALQ.OEP15
ON  CONO15 = CONO16
and PRTP15 = PRTP16  
INNER JOIN PRUBSYSTEM.S10EB95C.AULT2F3ALQ.OEP19 D
ON CONO16=CONO19   and PRTP16 = PRTP19  AND ITMG19=CUSG16
WHERE CONO15 in ( 'GA','DN') 
AND ( ENDT16 >= CONCAT(CAST(${PERIODO} AS STRING), '01') OR ENDT16='9999999') 
and PRTP16 NOT  IN ( 'DAT', 'DAS')
order by PNUM16,CUSG16;

update MAESTRO.CLIENTES AS C
SET CODIGO_LISTA_PRECIO=L.CODI_LISTA,
GRUPO_LISTA_PRECIO=L.GRUPO_LISTA,
NOMBRE_LISTA_PRECIO=L.DESC_LISTA  
FROM  COMERCIAL.PRECIO_LISTA AS L
WHERE  L.CODI_EMPRESA=C.CODI_EMPRESA
AND L.CODI_CLIENTE=C.CODI_CLIENTE
AND L.SECUENCIA=C.DIRE_ENTREGA 
AND C.CODI_EMPRESA IN ('DN','GA');